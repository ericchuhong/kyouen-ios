machine:
  timezone: Asia/Tokyo
  xcode:
    version: "8.2"
  environment:
    GYM_CODE_SIGNING_IDENTITY: "iPhone Distribution: NOBORU ISHIKURA (56W5SXE4HE)"
dependencies:
  pre:
    - brew update
    - brew install swiftlint
test:
  pre:
    - openssl aes-256-cbc -k $DECRYPT_KEY -d -in TumeKyouen/Resources/encrypted_GoogleService-Info.plist -out TumeKyouen/Resources/GoogleService-Info.plist
  override:
    - bundle exec fastlane analyze
deployment:
  master:
    branch: master
    commands:
      - npm install -g appium
      - appium > $CIRCLE_ARTIFACTS/appium_log.txt:
          background: true
      - git clone git@github.com:noboru-i/kyouen-ui-test.git
      - bundle exec fastlane build_for_appium
      - xcrun instruments -w 'F08BA729-6AD2-42DF-A210-34DC8D990011' || true
      - cd kyouen-ui-test; bundle install; OS=iOS bundle exec rspec spec
      - mv kyouen-ui-test/ss $CIRCLE_ARTIFACTS/
      - bundle exec fastlane beta
  release:
    tag: /v[0-9]+(\.[0-9]+)*/
    commands:
      - bundle exec fastlane release
